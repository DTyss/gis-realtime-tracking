{% extends 'tracking/master.html' %}
{% load static %}

{% block title %}
  B·∫£n ƒë·ªì theo d√µi v·ªã tr√≠
{% endblock %}

{% block content %}
  <style>
    .leaflet-marker-icon.user-avatar-icon {
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
    }
  </style>

  {% if not user.is_authenticated %}
    <script>
      if (confirm('B·∫°n ƒëang xem ·ªü ch·∫ø ƒë·ªô kh√°ch. B·∫°n c√≥ mu·ªën ƒëƒÉng nh·∫≠p kh√¥ng?')) {
        window.location.href = "{% url 'login' %}"
      }
    </script>
  {% endif %}

  <section id="map" class="section" style="padding-top: 100px;">
    <div class="container">
      <h3 class="text-center mb-4">V·ªã tr√≠ ng∆∞·ªùi d√πng (Realtime)</h3>

      <!-- N√∫t m·ªü sidebar -->
      <button id="toggleSidebarBtn" class="btn btn-dark position-absolute" style="top: 120px; left: 15px; z-index: 9999;margin: 20px 0 0 0">üë• Ng∆∞·ªùi d√πng</button>

      <!-- Sidebar tr·∫°ng th√°i ng∆∞·ªùi d√πng -->
      <div id="userStatusSidebar" class="user-status-sidebar shadow">
        <h5 class="px-3 pt-3 mb-2">Tr·∫°ng th√°i ng∆∞·ªùi d√πng</h5>
        <div class="px-3 pb-3">
          <button class="btn btn-sm btn-success w-100 mb-2" onclick="toggleList('online')">Tr·ª±c tuy·∫øn</button>
          <ul id="onlineUsers" class="list-group mb-3 user-scrollable"></ul>

          <button class="btn btn-sm btn-secondary w-100 mb-2" onclick="toggleList('offline')">Ngo·∫°i tuy·∫øn</button>
          <ul id="offlineUsers" class="list-group user-scrollable"></ul>
        </div>
      </div>

      <!-- THANH T√åM KI·∫æM -->
      <div class="row mb-4 justify-content-center">
        <div class="col-md-8">
          <div class="input-group">
            <input type="text" id="searchUser" class="form-control" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi d√πng c·∫ßn t√¨m" />
            <button class="btn btn-outline-primary" id="btnSearch">T√¨m</button>
          </div>
        </div>
      </div>

      <div id="mapid" style="height: 600px; border-radius: 10px;"></div>
    </div>
  </section>

  <!-- Leaflet CSS + JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Plugin Fullscreen cho Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.css" />
  <script src="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.js"></script>

  <!-- SCRIPT -->
  <script src="https://unpkg.com/@mapbox/polyline"></script>
  <script>
    const USER_IS_LOGGED_IN = "{{ user.is_authenticated|yesno:'true,false'|escapejs }}"
  </script>
  <script src="{% static 'tracking/js/map.js' %}"></script>
{% endblock %}
